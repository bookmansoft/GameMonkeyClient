var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},tiled;!function(t){var e=function(t){function e(e,i,r){var n=t.call(this)||this;return n._tilemap=e,n._data=i,n._z=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},enumerable:!0,configurable:!0}),e.prototype.draw=function(t){},e}(egret.Sprite);t.TMXLayerBase=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function t(t,e,i,r){this.rows=t,this.cols=e,this.tilewidth=i,this.tileheight=r,this.animationTiles=[]}return t.prototype.canRender=function(t){return this.cols===t.cols&&this.rows===t.rows&&this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight},t.prototype.drawTileLayer=function(t,e){},t.prototype.drawTile=function(t,e,i,r){},t.prototype.render=function(t){if(this.animationTiles)for(var e=egret.getTimer(),i=0;i<this.animationTiles.length;i++){var r=this.animationTiles[i],n=r.tmxTile,o=r.pos,s=n.animation,a=s.currentAnimationFrame;void 0==s.oldTime&&(s.oldTime=0),e-s.oldTime>a.duration&&(s.oldBitmap&&s.oldBitmap.parent&&s.oldBitmap.parent.removeChild(s.oldBitmap),this.drawTile(t,o[0],o[1],a.tile),s.oldBitmap=a.tile.bitmap,s.oldTime=e,s.render())}},t}();t.TMXRenderer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function t(){this.gid=0}return t}();t.TMXProperty=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function t(){}return t}();e.TMX_FLIP_H=2147483648,e.TMX_FLIP_V=1073741824,e.TMX_FLIP_AD=536870912,e.TMX_CLEAR_BIT_MASK=536870911,e.LAYER="layer",e.OBJECT_GROUP="objectgroup",e.PROPERTIES="properties",e.DATA="data",e.OBJECT="object",e.IMAGE="image",e.IMAGE_LAYER="imagelayer",e.TILE_SET="tileset",e.TILE="tile",e.TILE_OFFSET="tileoffset",e.ANIMATION="animation",e.DEFAULT_COLOR=10526884,e.DRAWORDER_INDEX="index",e.POLYGON="polygon",e.POLYLINE="polyline",e.ELLIPSE="ellipse",e.TILE_OBJECT_GROUP="tileobjectgroup",e.ORIENTATION_ORTHOGONAL="orthogonal",e.ORIENTATION_ISOMETRIC="isometric",e.ORIENTATION_STAGGERED="staggered",e.ORIENTATION_HEXAGONAL="hexagonal",t.TMXConstants=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(t){function e(e,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!0),void 0===n&&(n=!1);var o=t.call(this,e,r,n)||this;return o.texture=i,o}return __extends(e,t),e}(egret.Event);e.IMAGE_COMPLETE="complete",e.ALL_IMAGE_COMPLETE="allComplete",t.TMXImageLoadEvent=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n){var o=e.call(this)||this;return o._tilemap=i,o._color=r,o._z=n,o.graphics.beginFill(t.TMXUtils.color16ToUnit(o._color),1),o.graphics.drawRect(0,0,i.renderwidth,i.renderheight),o.graphics.endFill(),o}return __extends(i,e),i}(egret.Sprite);t.TMXColorLayer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n){var o=e.call(this,i,r,n)||this;o._name=r.attributes.name,o.x=+r.attributes.x,o.y=+r.attributes.y,o._z=n,o._opacity="undefined"!=typeof+r.attributes.opacity?+r.attributes.opacity:1,o.visible="undefined"!=typeof+r.attributes.visible?Boolean(+r.attributes.visible):!0;var s=r.children;if(s)for(var a=0;a<s.length;a++){var h=r.children[a];switch(h.localName){case t.TMXConstants.IMAGE:o._source=h.attributes.source,o._transColor=h.attributes.trans,o.loadImage(o.tilemap.baseURL+o._source);break;case t.TMXConstants.PROPERTIES:o._properties=o._tilemap.parseProperties(h);break;default:throw new Error("TMXTileMap decode ImageLayer is Error："+h.localName)}}return o}return __extends(i,e),Object.defineProperty(i.prototype,"bitmap",{get:function(){return this._bitmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._opacity},enumerable:!0,configurable:!0}),i.prototype.loadImage=function(e){null!=e&&""!=e&&RES.getResByUrl(e,function(e){e&&(this._sourcebitmap.texture=e,this._texture=e,this.dispatchEvent(new t.TMXImageLoadEvent(t.TMXImageLoadEvent.IMAGE_COMPLETE,e)))},this,RES.ResourceItem.TYPE_IMAGE)},i.prototype.draw=function(t){var e=new egret.RenderTexture,i=new egret.Rectangle(this.x,this.y,this._sourcebitmap.width,this._sourcebitmap.height);t=i.intersection(t),t.right=Math.ceil(this.tilemap.width/this.tilemap.tilewidth)*this.tilemap.tilewidth,t.bottom=Math.ceil(this.tilemap.height/this.tilemap.tileheight)*this.tilemap.tileheight,e.drawToTexture(this._sourcebitmap,t),this._bitmap=new egret.Bitmap,this._bitmap.texture=e,this._bitmap.alpha=this._opacity,this._bitmap.visible=this.visible,this.addChild(this._bitmap)},i}(t.TMXLayerBase);t.TMXImageLayer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n,o,s,a,h){var l=e.call(this,i,h,a)||this;l._staticContainer=new egret.Sprite,l.addChild(l._staticContainer),setTimeout(function(t){t._staticContainer.cacheAsBitmap=!0},2e3,l),l._animationContainer=new egret.Sprite,l.addChild(l._animationContainer),l._tilemap=i,l._tilewidth=r,l._tileheight=n,l._orientation=o,l._tilesets=s,l.tileset=l._tilesets?l._tilesets.getTilesetByIndex(0):null,l.maxTileSize={width:0,height:0};for(var u=0;u<l._tilesets.length;u++){var p=l._tilesets.getTilesetByIndex(u);l.maxTileSize.width=Math.max(l.maxTileSize.width,p.tilewidth),l.maxTileSize.height=Math.max(l.maxTileSize.height,p.tileheight)}l._name=h.attributes.name,l._cols=+h.attributes.width,l._rows=+h.attributes.height,l._opacity="undefined"!=typeof h.attributes.opacity?parseFloat(h.attributes.opacity):1,l.visible="undefined"!=typeof h.attributes.visible?Boolean(+h.attributes.visible):!0,l._hexsidelength=+h.attributes.hexsidelength,l._staggeraxis=h.attributes.staggeraxis,l._staggerindex=+h.attributes.staggerindex,"isometric"===l._orientation?(l.width=(l._cols+l._rows)*(l._tilewidth/2),l.height=(l._cols+l._rows)*(l._tileheight/2)):(l.width=l._cols*l._tilewidth,l.height=l._rows*l._tileheight),l.initArray(l._cols,l._rows);var c=h.children;if(c)for(var u=0;u<c.length;u++){var d=c[u];switch(d.localName){case t.TMXConstants.DATA:l.parseLayerData(t.TMXUtils.decode(d,d.attributes.encoding,d.attributes.compression));break;case t.TMXConstants.PROPERTIES:l._properties=l.tilemap.parseProperties(d);break;default:throw new Error("TMXTileMap decode Layer is Error："+d.localName)}}return l.alpha=l._opacity,l.visible=l.visible,l}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staticContainer",{get:function(){return this._staticContainer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationContainer",{get:function(){return this._animationContainer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hexsidelength",{get:function(){return this._hexsidelength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staggeraxis",{get:function(){return this._staggeraxis},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staggerindex",{get:function(){return this.staggerindex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"opacity",{get:function(){return this._opacity},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),i.prototype.setRenderer=function(t){this.renderer=t},i.prototype.getTileId=function(t,e){var i=this.getTile(t,e);return i?i.gid:0},i.prototype.getTile=function(e,i){return this.renderer instanceof t.TMXOrthogonalRenderer?this.layerData[~~this.renderer.pixelToTileX(e)][~~this.renderer.pixelToTileY(i)]:this.renderer instanceof t.TMXIsometricRenderer?this.layerData[~~this.renderer.pixelToTileX(e,i)][~~this.renderer.pixelToTileY(i,e)]:this.layerData[~~this.renderer.pixelToTileX(e,i)][~~this.renderer.pixelToTileY(i,e)]},i.prototype.setTile=function(e,i,r){if(this.tileset.contains(r)||(this.tileset=this._tilesets.getTilesetByGid(r)),this.tileset){var n=this.layerData[e][i]=new t.TMXTile(e,i,r,this.tilemap,this.tileset);return n}return null},i.prototype.clearTile=function(t,e){this.layerData[t][e]=null},i.prototype.draw=function(t){this.renderer.drawTileLayer(this,t)},i.prototype.render=function(){this.renderer.render(this._animationContainer)},i.prototype.initArray=function(t,e){this.layerData=[];for(var i=0;t>i;i++){this.layerData[i]=[];for(var r=0;e>r;r++)this.layerData[i][r]=null}},i.prototype.parseLayerData=function(t){if(t)for(var e=0,i=0;i<this.rows;i++)for(var r=0;r<this.cols;r++){var n=t[e];0!==n&&this.setTile(r,i,n),e++}},i}(t.TMXLayerBase);t.TMXLayer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n,o){var s=e.call(this)||this;s._tmxRenderer=null,s._data=n,s._renderWidth=i,s._renderHeight=r,s._rows=+n.attributes.width,s._cols=+n.attributes.height,s._tilewidth=+n.attributes.tilewidth,s._tileheight=+n.attributes.tileheight,s._nextobjectid=+n.attributes.nextobjectid,s._version=+n.attributes.version,s._orientation=n.attributes.orientation,s._renderorder=n.attributes.renderorder,s._baseURL=o,s._baseURL=decodeURIComponent(s._baseURL);var a=s._baseURL.lastIndexOf("/");return s._baseURL=s._baseURL.slice(0,a+1),s._orientation===t.TMXConstants.ORIENTATION_ISOMETRIC?(s.width=(s._rows+s._cols)*(s._tilewidth/2),s.height=(s._rows+s._cols)*(s._tileheight/2)):(s.width=s._rows*s._tilewidth,s.height=s._cols*s._tileheight),s._hexsidelength=+n.attributes.hexsidelength,s._staggeraxis=n.attributes.staggeraxis||void 0,s._staggerindex=n.attributes.staggerindex||void 0,s._backgroundcolor=n.attributes.backgroundcolor,s._z=0,s._layers=[],null!==s._tmxRenderer&&s._tmxRenderer.canRender(s)||(s._tmxRenderer=s.getNewDefaultRenderer(s)),s._initialized=!1,s}return __extends(i,e),Object.defineProperty(i.prototype,"nextobjectid",{get:function(){return this._nextobjectid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseURL",{get:function(){return this._baseURL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderwidth",{get:function(){return this._renderWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderheight",{get:function(){return this._renderHeight},enumerable:!0,configurable:!0}),i.prototype.render=function(){for(var t=this.getLayers(),e=0;e<t.length;e++)this.addChild(t[e]);this.addEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this)},i.prototype.getLayers=function(){return this.readMapObjects(this._data),this._layers},i.prototype.getObjects=function(){this.readMapObjects(this._data);for(var e=[],i=0;i<this._layers.length;i++)this._layers[i]instanceof t.TMXObjectGroup&&e.push(this._layers[i]);return e},i.prototype.parseProperties=function(e){var i,r=e.children;if(r){i=[];for(var n=0;n<r.length;n++){var o=r[n],s=new t.TMXProperty;s.name=o.attributes.name,s.value=o.attributes.value,i[n]=s}}return i},i.prototype.showHideBackground=function(e){this._showHideBackground=e;for(var i=0;i<this._layers.length;i++){var r=this._layers[i];if(r instanceof t.TMXColorLayer)return void(r.visible=e)}},i.prototype.destory=function(){this._tilesets=void 0,this._layers=[],this._initialized=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this),t.TMXTileset.removeAllTextures(),this.parent&&this.parent.removeChild(this)},i.prototype.readMapObjects=function(e){if(this._initialized!==!0){var i=this._z,r=this;this._tilesets||(this._tilesets=new t.TMXTilesetGroup(this)),this._backgroundcolor&&this._showHideBackground&&this._layers.push(new t.TMXColorLayer(this,this._backgroundcolor,i++));var n=this._data.children;if(n)for(var o=0;o<n.length;o++){var s=n[o];switch(s.localName){case t.TMXConstants.TILE_SET:this._tilesets.add(new t.TMXTileset(this,s));break;case t.TMXConstants.LAYER:this._layers.push(this.parseLayer(s,i++));break;case t.TMXConstants.OBJECT_GROUP:this._layers.push(this.parseObjectGroup(s,i++));break;case t.TMXConstants.PROPERTIES:this._properties=this.parseProperties(s);break;case t.TMXConstants.IMAGE_LAYER:this._layers.push(this.parseImageLayer(s,i++))}}for(var a=0,o=0;o<this._tilesets.length;o++)for(var h=this._tilesets.getTilesetByIndex(o),l=0;l<h.images.length;l++){var u=h.images[l],p=function(e){var i=e.currentTarget;i.removeEventListener(t.TMXImageLoadEvent.IMAGE_COMPLETE,p,this),a++,a==this._tilesets.imagelength&&r.dispatchEvent(new t.TMXImageLoadEvent(t.TMXImageLoadEvent.ALL_IMAGE_COMPLETE))};u.addEventListener(t.TMXImageLoadEvent.IMAGE_COMPLETE,p,this)}this._initialized=!0}},i.prototype.onStartRendering=function(e){for(var i=this.getLayers(),r=0;r<i.length;r++){var n=i[r];n instanceof t.TMXLayer&&n.render()}for(var o=this.getObjects(),r=0;r<o.length;r++){o[r]}},i.prototype.getNewDefaultRenderer=function(e){switch(e._orientation){case"orthogonal":return new t.TMXOrthogonalRenderer(e.rows,e.cols,e.tilewidth,e.tileheight);case"isometric":return new t.TMXIsometricRenderer(e.rows,e.cols,e.tilewidth,e.tileheight);case"hexagonal":return new t.TMXHexagonalRenderer(e.rows,e.cols,e.tilewidth,e.tileheight,e._hexsidelength,e._staggeraxis,e._staggerindex);default:throw new Error(e._orientation+" type TMX Tile Map not supported!")}},i.prototype.parseLayer=function(e,i){var r=new t.TMXLayer(this,this._tilewidth,this._tileheight,this._orientation,this._tilesets,i,e);this._tmxRenderer.canRender(r)?r.setRenderer(this.getNewDefaultRenderer(this)):r.setRenderer(this._tmxRenderer);var n=this,o=function(e){n.removeEventListener(t.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,this),this.draw(new egret.Rectangle(0,0,n._renderWidth,n._renderHeight))};return this.addEventListener(t.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,r),r},i.prototype.parseObjectGroup=function(e,i){var r=new t.TMXObjectGroup(e,this._orientation,this._tilesets,i),n=this,o=function(e){n.removeEventListener(t.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,this),this.draw(new egret.Rectangle(0,0,n._renderWidth,n._renderHeight))};return this.addEventListener(t.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,r),r},i.prototype.parseTileset=function(e){return new t.TMXTileset(this,e)},i.prototype.parseImageLayer=function(e,i){var r=this,n=new t.TMXImageLayer(this,e,i),o=function(t){this.draw(new egret.Rectangle(0,0,r._renderWidth,r._renderHeight))};return n.addEventListener(t.TMXImageLoadEvent.IMAGE_COMPLETE,o,n),n},i}(egret.Sprite);t.TMXTilemap=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(t,i){var r=e.call(this)||this;return r._width=+t.attributes.width,r._height=+t.attributes.height,r._source=t.attributes.source,r._trans="undefined"!=typeof t.attributes.trans?t.attributes.trans:"000000",r._bitmap=new egret.Bitmap,r._source=i+r._source,r.loadImage(r._source),r}return __extends(i,e),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bitmap",{get:function(){return this._bitmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),i.prototype.loadImage=function(e){null!=e&&""!=e&&RES.getResByUrl(e,function(e){e&&(this._bitmap.texture=e,this._texture=e,this._width=e.textureWidth,this._height=e.textureHeight,this.dispatchEvent(new t.TMXImageLoadEvent(t.TMXImageLoadEvent.IMAGE_COMPLETE,e)))},this,RES.ResourceItem.TYPE_IMAGE)},i}(egret.EventDispatcher);t.TMXImage=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n,o,s){var a=e.call(this)||this;if(a._points=void 0,a._name=i.attributes.name,a.x=+i.attributes.x,a.y=+i.attributes.y,a._z=+o,a.width=+i.attributes.width||0,a.height=+i.attributes.height||0,a._gid=+i.attributes.gid||null,a._type=i.attributes.type,a.rotation=+i.attributes.rotation||0,a._id=+i.attributes.id||void 0,a._orientation=r,a._shapes=void 0,a._color=s,a._isEllipse=!1,a._isPolygon=!1,a._isPolyLine=!1,a.visible="undefined"!=typeof i.attributes.visible?Boolean(+i.attributes.visible):!0,"number"==typeof a._gid)a._isImage=!0,a.setTile(n);else{a._points=[];var h=i.children;if(h)for(var l=0;l<h.length;l++){var u=h[l];switch(u.localName){case t.TMXConstants.ELLIPSE:a._isEllipse=!0,a._isImage=!1,a._ellipse=a.parseEllipse(u);break;case t.TMXConstants.POLYGON:a._isPolygon=!0,a._isImage=!1,a._points=a.parsePolygonOrPolyline(u.attributes.points);break;case t.TMXConstants.POLYLINE:a._isPolyLine=!0,a._isImage=!1,a._points=a.parsePolygonOrPolyline(u.attributes.points);break;case t.TMXConstants.PROPERTIES:n.tilemap&&(a._properties=n.tilemap.parseProperties(u))}}}a._shapes||(a._shapes=a.parseTMXShapes());for(var l=0;l<a._shapes.length;l++){var p=a._shapes[l];a.addChild(p)}return a}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gid",{get:function(){return this._gid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isEllipse",{get:function(){return this._isEllipse},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPolygon",{get:function(){return this._isPolygon},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPolyLine",{get:function(){return this._isPolyLine},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isImage",{get:function(){return this._isImage},enumerable:!0,configurable:!0}),i.prototype.parsePolygonOrPolyline=function(t){var e=[],i=t.split(" ");if(i)for(var r=0;r<i.length;r++){var n=i[r].split(",");e[r]=[+n[0],+n[1]]}return e},i.prototype.parseEllipse=function(t){var e=+t.attributes.width||32,i=+t.attributes.height||32;return[e,i]},i.prototype.parseTMXShapes=function(){var e=[];if(this._isEllipse){var i=new t.Ellipse(0,0,this.width,this.height);i.draw(this._color),e.push(i)}else if(this._isPolygon){var r=new t.Polygon(0,0,this._points);r.draw(this._color),e.push(r)}else if(this._isPolyLine){var n=new t.PolyLine(0,0,this._points);n.draw(this._color),e.push(n)}else if(!this._gid){var r=new t.Polygon(0,0,[[0,0],[this.width,0],[this.width,this.height],[0,this.height]]);r.draw(this._color),e.push(r)}if("isometric"===this._orientation)for(var o=0;o<e.length;o++){var s=e[o];s.rotation=45,s.scaleX=Math.SQRT1_2,s.scaleY=Math.SQRT1_2}return e},i.prototype.setTile=function(e){var i=e.getTilesetByGid(this._gid);i&&(this._tile=new t.TMXTile(0,0,this.gid,i.tilemap,i),i.drawTile(this,i.tileoffset.x,i.tileoffset.y-i.tileheight,this._tile))},i}(egret.Sprite);t.TMXObject=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n,o){var s=e.call(this)||this;return s._name=i.attributes.name,s._opacity="undefined"!=typeof i.attributes.opacity?+i.attributes.opacity:1,s._draworder=i.attributes.draworder,s._color=i.attributes.color?t.TMXUtils.color16ToUnit(i.attributes.color):t.TMXConstants.DEFAULT_COLOR,s._orientaion=r,s._tilesets=n,s._z=o,s.visible="undefined"!=typeof i.attributes.visible?Boolean(+i.attributes.visible):!0,s._objects=[],s._objectHash={},s._childrens=i.children,s}return __extends(i,e),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),i.prototype.draw=function(){if(this._childrens)for(var e=0;e<this._childrens.length;e++){var i=new t.TMXObject(this._childrens[e],this._orientaion,this._tilesets,this._z,this._color);i.alpha=this._opacity,this._objects[e]=i,this.addChild(i),this._objectHash[i.id]=i}},i.prototype.render=function(){},i.prototype.destory=function(){this._objects=null},i.prototype.getObjectById=function(t){return this._objectHash[t]},i.prototype.removeObjectById=function(t){var e=this.getObjectById(t);e&&e.parent&&e.parent.removeChild(e)},i.prototype.showHideObjectById=function(t,e){var i=this.getObjectById(t);i&&(i.visible=!0)},i.prototype.getObjectCount=function(){return this._childrens.length},i.prototype.getObjectByIndex=function(t){return this._objects[t]},i.prototype.removeObjectByIndex=function(t){var e=this.getObjectByIndex(t);e&&e.parent&&e.parent.removeChild(e)},i}(egret.Sprite);t.TMXObjectGroup=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function e(e,i,r,n,o){if(this.tileX=r,this.tileY=n,this._currentFrame=0,o){this._tilemap=e,this._tileset=i,this._data=o,this._animations=[],this._currentFrame=0;var s=o.children;if(s)for(var a=0;a<s.length;a++){var h=s[a],l=new t.TMXAnimationFrame(e,i,r,n,h);this._animations[a]=l}}}return e.prototype.render=function(){this._currentFrame++,this._currentFrame=this._currentFrame%this._animations.length},Object.defineProperty(e.prototype,"currentAnimationFrame",{get:function(){return this._animations[this._currentFrame]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),e}();t.TMXAnimation=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(t,i,r,n,o,s,a){var h=e.call(this,t,i,r,n)||this;return h._hexsidelength=o,h._staggeraxis=s,h._staggerindex=a,h._sidelengthx=0,h._sidelengthy=0,"x"===s?h._sidelengthx=o:h._sidelengthy=o,h._sideoffsetx=(h.tilewidth-h._sidelengthx)/2,h._sideoffsety=(h.tileheight-h._sidelengthy)/2,h._columnwidth=h._sideoffsetx+h._sidelengthx,h._rowheight=h._sideoffsety+h._sidelengthy,h._centers=[new egret.Point,new egret.Point,new egret.Point,new egret.Point],h}return __extends(i,e),i.prototype.canRender=function(i){return i.orientation===t.TMXConstants.ORIENTATION_HEXAGONAL&&e.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(t,e){"x"===this._staggeraxis?t-="old"===this._staggerindex?this._sidelengthx:this.tilewidth:e-="old"===this._staggerindex?this._sideoffsety:this.tileheight;var i=new egret.Point(Math.floor(t/(this.tilewidth+this._sidelengthx)),Math.floor(e/(this.tileheight+this._sidelengthy))),r=new egret.Point(t-i.x*(this.tilewidth+this._sidelengthx),e-i.y*(this.tilewidth+this._sidelengthy));"x"===this._staggeraxis?(i.x=2*i.x,"even"===this._staggerindex&&++i.x):(i.y=2*i.y,"even"===this._staggerindex&&++i.y);var n,o,s,a;"x"===this._staggeraxis?(n=this._sidelengthx/2,s=n+this._columnwidth,a=this.tileheight/2,this._centers[0].setTo(n,a),this._centers[1].setTo(s,a-this._rowheight),this._centers[2].setTo(s,a+this._rowheight),this._centers[3].setTo(s+this._columnwidth,a)):(o=this._sidelengthy/2,s=this.tilewidth/2,a=o+this._rowheight,this._centers[0].setTo(s,o),this._centers[1].setTo(s-this._columnwidth,a),this._centers[2].setTo(s+this._columnwidth,a),this._centers[3].setTo(s,a+this._rowheight));for(var h,l=0,u=Number.MAX_VALUE,p=0;4>p;++p)h=Math.pow(this._centers[p].x-r.x,2)+Math.pow(this._centers[p].y-r.y,2),u>h&&(u=h,l=p);var c=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],d=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}],g="x"===this._staggeraxis?c:d;return new egret.Point(i.x+g[l].x,i.y+g[l].y)},i.prototype.pixelToTileX=function(t,e){var i=this.pixelToTileCoords(t,e);return i.x},i.prototype.pixelToTileY=function(t,e){var i=this.pixelToTileCoords(e,t);return i.y},i.prototype.tileToPixelCoords=function(t,e){var i,r;return"x"===this._staggeraxis?(i=t*this._columnwidth,"odd"===this._staggerindex?(r=e*(this.tileheight+this._sidelengthy),r+=this._rowheight*(1&t)):(r=e*(this.tileheight+this._sidelengthy),r+=this._rowheight*(1-(1&t)))):(r=e*this._rowheight,"odd"===this._staggerindex?(i=t*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1&e)):(i=t*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1-(1&e)))),new egret.Point(i,r)},i.prototype.drawTile=function(t,e,i,r){var n=this.tileToPixelCoords(e,i),o=r.tileset;o.drawTile(t,o.tileoffset.x+n.x,o.tileoffset.y+n.y+(this.tileheight-o.tileheight),r)},i.prototype.drawTileLayer=function(t,e){var i=t.staticContainer,r=this.pixelToTileCoords(Math.floor(e.x),Math.floor(e.y)),n=this.pixelToTileCoords(Math.floor(e.x+e.width+this.tilewidth),Math.floor(e.y+e.height+this.tileheight));r.x=r.x<0?0:r.x,r.y=r.y<0?0:r.y,n.x=n.x>this.rows?this.rows:n.x,n.y=n.y>this.cols?this.cols:n.y;for(var o=r.y;o<n.y;o++)for(var s=r.x;s<n.x;s++){var a=t.layerData[s][o];a&&(a.animation?this.animationTiles.push({tmxTile:a,pos:[s,o]}):this.drawTile(i,s,o,a))}},i}(t.TMXRenderer);t.TMXHexagonalRenderer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(t,i,r,n){var o=e.call(this,t,i,r,n)||this;return o._hTilewidth=o.tilewidth/2,o._hTileheight=o.tileheight/2,o._originX=o.rows*o._hTilewidth,o}return __extends(i,e),i.prototype.canRender=function(i){return i.orientation===t.TMXConstants.ORIENTATION_ISOMETRIC&&e.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(t,e){Math.floor(this.pixelToTileX(t,e)),Math.floor(this.pixelToTileY(e,t));return new egret.Point(this.pixelToTileX(t,e),this.pixelToTileY(e,t))},i.prototype.pixelToTileX=function(t,e){e/this.tileheight+(t-this._originX)/this.tilewidth;return e/this.tileheight+(t-this._originX)/this.tilewidth},i.prototype.pixelToTileY=function(t,e){t/this.tileheight-(e-this._originX)/this.tilewidth;return t/this.tileheight-(e-this._originX)/this.tilewidth},i.prototype.tileToPixelCoords=function(t,e){return new egret.Point((t-e)*this._hTilewidth+this._originX,(t+e)*this._hTileheight)},i.prototype.drawTile=function(t,e,i,r){var n=r.tileset;n.drawTile(t,n.tileoffset.x+e,n.tileoffset.y+i-n.tileheight,r)},i.prototype.drawTileLayer=function(t,e){var i=t.staticContainer,r=t.tileset,n=r.tileoffset,o=this.pixelToTileCoords(e.x-r.tilewidth,e.y-r.tileheight);o=new egret.Point(Math.floor(o.x),Math.floor(o.y));var s=this.pixelToTileCoords(e.x+e.width+r.tilewidth,e.y+e.height+r.tileheight);s=new egret.Point(Math.ceil(s.x),Math.ceil(s.y));var a=this.tileToPixelCoords(s.x,s.y),h=this.tileToPixelCoords(o.x,o.y);h.x-=this._hTilewidth,h.y+=this.tileheight;var l=h.y-e.y>this._hTileheight,u=e.x-h.x<this._hTilewidth;l&&(u?(o.x--,h.x-=this._hTilewidth):(o.y--,h.x+=this._hTilewidth),h.y-=this._hTileheight);for(var p=Boolean(+l^+u),c=o.clone(),d=h.y;d-this.tileheight<a.y;d+=this._hTileheight){c.setTo(o.x,o.y);for(var g=h.x;g<a.x;g+=this.tilewidth){if(c.x>=0&&c.y>=0&&c.x<this.rows&&c.y<this.cols){var _=t.layerData[c.x][c.y];_&&(r=_.tileset,n=r.tileoffset,_&&(_.animation?this.animationTiles.push({tmxTile:_,pos:[n.x+g,n.y+d]}):this.drawTile(i,g,d,_)))}c.x++,c.y--}p?(o.y++,h.x-=this._hTilewidth,p=!1):(o.x++,h.x+=this._hTilewidth,p=!0)}},i}(t.TMXRenderer);t.TMXIsometricRenderer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(t,i,r,n){return e.call(this,t,i,r,n)||this}return __extends(i,e),i.prototype.canRender=function(i){return i.orientation===t.TMXConstants.ORIENTATION_ORTHOGONAL&&e.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(t,e){return new egret.Point(this.pixelToTileX(t),this.pixelToTileY(e))},i.prototype.pixelToTileX=function(t){return Math.floor(t/this.tilewidth)},i.prototype.pixelToTileY=function(t){return Math.floor(t/this.tileheight)},i.prototype.tileToPixelCoords=function(t,e){return new egret.Point(t*this.tilewidth,e*this.tileheight)},i.prototype.drawTile=function(t,e,i,r){var n=r.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,r)},i.prototype.drawTileLayer=function(t,e){var i=t.staticContainer,r=this.pixelToTileCoords(Math.floor(Math.max(e.x-(t.maxTileSize.width-t.tilewidth),0)),Math.floor(Math.max(e.y-(t.maxTileSize.height-t.tileheight),0))),n=this.pixelToTileCoords(Math.ceil(e.x+e.width+this.tilewidth),Math.ceil(e.y+e.height+this.tileheight));n.x=n.x>this.rows?this.rows:n.x,n.y=n.y>this.cols?this.cols:n.y;for(var o=r.y;o<n.y;o++)for(var s=r.x;s<n.x;s++){var a=t.layerData[s][o];a&&(a.animation?this.animationTiles.push({tmxTile:a,pos:[s,o]}):this.drawTile(i,s,o,a))}},i}(t.TMXRenderer);t.TMXOrthogonalRenderer=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function e(e,i,r,n,o){this._tiledid=+o.attributes.tileid,this._duration=+o.attributes.duration,this._tile=new t.TMXTile(r,n,this._tiledid+i.firstgid,e,i,!1)}return Object.defineProperty(e.prototype,"tile",{get:function(){return this._tile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiledId",{get:function(){return this._tiledid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();t.TMXAnimationFrame=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(t){function e(e,i,r,n){var o=t.call(this)||this;return o.x=e,o.y=i,o.width=r,o.height=n,o}return __extends(e,t),e.prototype.draw=function(t){this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this.graphics.drawEllipse(0,0,this.width,this.height),this.graphics.endFill()},e}(egret.Sprite);t.Ellipse=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(t){function e(e,i,r){var n=t.call(this)||this;return n.points=r,n.x=e,n.y=i,n}return __extends(e,t),e.prototype.draw=function(t){if(this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this.points)for(var e=0;e<this.points.length;e++){var i=this.points[e];0==e?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},e}(egret.Sprite);t.PolyLine=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(t){function e(e,i,r){var n=t.call(this)||this;return n.points=r,n.x=e,n.y=i,n}return __extends(e,t),e.prototype.draw=function(t){if(this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this.points)for(var e=0;e<this.points.length;e++){var i=this.points[e];0==e?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},e}(egret.Sprite);t.Polygon=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(e){function i(i,r,n,o,s,a){void 0===a&&(a=!0);var h=e.call(this)||this;if(h._tileset=s,h._tileX=i,h._tileY=r,h._tilemap=o,h._gid=n,h._flippedX=0!==(h._gid&t.TMXConstants.TMX_FLIP_H),h._flippedY=0!==(h._gid&t.TMXConstants.TMX_FLIP_V),h._flippedAD=h._flippedX&&h._flippedY,h._flipped=h._flippedX||h._flippedY||h._flippedAD,h._gid&=t.TMXConstants.TMX_CLEAR_BIT_MASK,h._tileData=s.getSpecialTileDataByTileId(h._gid),h._tileData){var l=h._tileData.children;if(l)for(var u=0;u<l.length;u++){var p=l[u];switch(p.localName){case t.TMXConstants.PROPERTIES:h._properties=o.parseProperties(p);
break;case t.TMXConstants.OBJECT_GROUP:break;case t.TMXConstants.IMAGE:h._image=new t.TMXImage(p,h.tilemap.baseURL);break;case t.TMXConstants.ANIMATION:a&&(h._animation=new t.TMXAnimation(o,s,i,r,p))}}}return h}return __extends(i,e),Object.defineProperty(i.prototype,"gid",{get:function(){return this._gid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileX",{get:function(){return this._tileX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileY",{get:function(){return this._tileY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileset",{get:function(){return this._tileset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedX",{get:function(){return this._flippedX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedY",{get:function(){return this._flippedY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedAD",{get:function(){return this._flippedAD},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipped",{get:function(){return this._flipped},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),i}(egret.Sprite);t.TMXTile=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function e(e,i){this.getFileExtension=function(t){return t.substring(t.lastIndexOf(".")+1,t.length)},this._tileDatas=[],this._firstgid=+i.attributes.firstgid,this._lastgid=this._firstgid,this._tilemap=e;var r=i.attributes.source;if(r&&"tsx"===this.getFileExtension(r))throw new Error("tmx not support tsx file load!!!");this._transformMatrix=new egret.Matrix,this._name=i.attributes.name,this._tilewidth=+i.attributes.tilewidth,this._tileheight=+i.attributes.tileheight,this._spacing=+i.attributes.spacing||0,this._margin=+i.attributes.margin||0,this._tileoffset=new egret.Point,this._hTileCount=0,this._vTileCount=0,this._images=[];var n=i.children;if(n)for(var o=0;o<n.length;o++){var s=n[o];switch(s.localName){case t.TMXConstants.IMAGE:this._image=new t.TMXImage(s,this.tilemap.baseURL),this._imagesource=this._image.source,this._images.push(this._image);break;case t.TMXConstants.TILE_OFFSET:this._tileoffset=new egret.Point(+s.attributes.x,+s.attributes.y);break;case t.TMXConstants.TILE:var a=+s.attributes.id+this._firstgid;null==this._tileDatas[a]&&(this._tileDatas[a]=s),s.children&&s.children.length>0&&s.children[0].localName==t.TMXConstants.IMAGE&&(this._image=new t.TMXImage(s.children[0],this.tilemap.baseURL),this._imagesource=this._image.source,this._images.push(this._image));break;case t.TMXConstants.PROPERTIES:this._properties=e.parseProperties(s)}}this._image&&(this._hTileCount=~~(this._image.width/(this._tilewidth+this._spacing)),this._vTileCount=~~(this._image.height/(this._tileheight+this._margin)),this._lastgid=this._firstgid+(this._hTileCount*this._vTileCount-1||0))}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstgid",{get:function(){return this._firstgid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastgid",{get:function(){return this._lastgid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spacing",{get:function(){return this._spacing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileoffset",{get:function(){return this._tileoffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalTileCount",{get:function(){return this._hTileCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalTileCount",{get:function(){return this._vTileCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"images",{get:function(){return this._images},enumerable:!0,configurable:!0}),e.prototype.getSpecialTileDataByTileId=function(t){return this._tileDatas[t]},e.prototype.getProperties=function(){return this._properties},e.prototype.getPropertyByIndex=function(t){return this._properties&&t<this._properties.length?this._properties[t]:null},e.prototype.contains=function(t){return t>=this._firstgid&&t<=this._lastgid},e.prototype.drawTile=function(e,i,r,n){var o,s,a;if(a=[],this.images)for(var h=0;h<this.images.length;h++){var l=this.images[h];l&&(null==t.TMXTileset.spritesheets[l.source]?(s=new egret.SpriteSheet(l.texture),t.TMXTileset.spritesheets[l.source]=s):s=t.TMXTileset.spritesheets[l.source])}for(var h=0;h<this.images.length;h++){var u=this.images[h];u&&a.push(t.TMXTileset.spritesheets[u.source])}var p,c=n.gid-this.firstgid,d=this.firstgid+"_"+c;if(this.images.length>1){p=a[n.gid-this.firstgid];var g=new egret.Rectangle(0*(this.tilewidth+this._spacing)+this._spacing,0*(this.tileheight+this._margin)+this._margin,this.tilewidth,this.tileheight)}else{p=a[0];var g=new egret.Rectangle(c%this.horizontalTileCount*(this.tilewidth+this._spacing)+this._spacing,Math.floor(c/this.horizontalTileCount)*(this.tileheight+this._margin)+this._margin,this.tilewidth,this.tileheight)}o=p.createTexture(d,g.x,g.y,g.width,g.height,0,0);var _=!1,f=!1;e instanceof t.TMXObject&&(f=!0,_=e.isImage),this._transformMatrix.identity();var y=f?g.width/o.textureWidth:1,b=f?g.height/o.textureHeight:1;n.flippedAD?(this._transformMatrix.scale(-1*y,-1*b),this._transformMatrix.translate(i+g.width*y,r+g.height*b)):n.flippedY?(this._transformMatrix.scale(1*y,-1*b),this._transformMatrix.translate(i,r+g.height*b)):n.flippedX?(this._transformMatrix.scale(-1*y,1*b),this._transformMatrix.translate(i+g.width*y,r)):(this._transformMatrix.scale(y,b),this._transformMatrix.translate(i,r+(f?o.textureHeight-g.height:0))),null==n.bitmap&&(n.bitmap=new egret.Bitmap),n.bitmap.texture=o,n.bitmap.matrix=this._transformMatrix,e.addChild(n.bitmap),n.bitmap=n.bitmap},e.removeAllTextures=function(){for(var t in this.spritesheets)var e=this.spritesheets[t];this.spritesheets={}},e}();e.spritesheets={},t.TMXTileset=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function e(t){this._tilesets=[],this._length=0,this._imagelength=0,this._tilemap=t}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imagelength",{get:function(){return this._imagelength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),e.prototype.add=function(t){this._tilesets.push(t),this._length++,t.images&&(this._imagelength+=t.images.length)},e.prototype.getTilesetByIndex=function(t){return this._tilesets[t]},e.prototype.getTilesetByGid=function(e){if(0===e)return null;var i=-1;e&=t.TMXConstants.TMX_CLEAR_BIT_MASK;for(var r=0,n=this._tilesets.length;n>r;r++){var o=this._tilesets[r];if(o.contains(e))return o;o.firstgid===o.lastgid&&e>=o.firstgid&&(i=r)}if(-1!==i)return this._tilesets[i];throw new Error("no matching tileset found for gid "+e)},e}();t.TMXTilesetGroup=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"nativeBase64",{get:function(){return"function"==typeof window.atob},enumerable:!0,configurable:!0}),t.decode=function(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(t);for(var e,i,r,n,o,s,a,h=[],l=0;l<t.length;)n=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),e=n<<2|o>>4,i=(15&o)<<4|s>>2,r=(3&s)<<6|a,h.push(String.fromCharCode(e)),64!==s&&h.push(String.fromCharCode(i)),64!==a&&h.push(String.fromCharCode(r));return h=h.join("")},t.encode=function(t){if(t=t.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var e,i,r,n,o,s,a,h=[],l=0;l<t.length;)e=t.charCodeAt(l++),i=t.charCodeAt(l++),r=t.charCodeAt(l++),n=e>>2,o=(3&e)<<4|i>>4,s=(15&i)<<2|r>>6,a=63&r,isNaN(i)?s=a=64:isNaN(r)&&(a=64),h.push(this._keyStr.charAt(n)),h.push(this._keyStr.charAt(o)),h.push(this._keyStr.charAt(s)),h.push(this._keyStr.charAt(a));return h=h.join("")}window.btoa(t)},t.decodeBase64AsArray=function(e,i){i=i||1;var r,n,o,s=t.decode(e),a=new Uint32Array(s.length/i);for(r=0,o=s.length/i;o>r;r++)for(a[r]=0,n=i-1;n>=0;--n)a[r]+=s.charCodeAt(r*i+n)<<(n<<3);return a},t.decompress=function(t,e,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},t.decodeCSV=function(t){for(var e=t.replace("\n","").trim().split(","),i=[],r=0;r<e.length;r++)i.push(+e[r]);return i},t}();e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.Base64=e}(tiled||(tiled={}));var tiled;!function(t){var e=function(){function e(){}return e.create=function(e,i,r,n,o,s){void 0===o&&(o=null),void 0===s&&(s=null),RES.getResByUrl(r,function(a){try{var a=egret.XML.parse(a)}catch(h){throw new Error("tmx文件格式不正确！")}var l=new t.TMXTilemap(e,i,a,r);l.render(),n.addChild(l),o&&o.apply(s)},this,RES.ResourceItem.TYPE_XML)},e.decode=function(e,i,r){r=r||"none",i=i||"none";var n=e.children[0].text;switch(i){case"base64":var o=t.Base64.decodeBase64AsArray(n,4);return"none"===r?o:t.Base64.decompress(n,o,r);case"csv":return t.Base64.decodeCSV(n);case"none":for(var s=[],a=0;a<e.children.length;a++)s[a]=+e.children[a].attributes.gid;return s;default:throw new Error("未定义的编码:"+i)}},e.color16ToUnit=function(t){var e="0x"+t.slice(1);return parseInt(e,16)},e}();t.TMXUtils=e}(tiled||(tiled={}));